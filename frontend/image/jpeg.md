# JPEG(Joint Photographic Experts Group)

> 정지 화상을 위해서 만들어진 손실 압축 방법 표준; .jpg, .jpeg, .jpe 등의 확장자를 사용

- 손실 압축 형식이지만 파일 크기가 작기 때문에 웹에서 널리 쓰임; 압출률을 높이면 파일 크기는 작아지지만 이미지 품질은 더욱 떨어짐
- 문자, 선, 세밀한 격자 등 고주파 성분이 많은 이미지 변환에서는 TIFF, GIF나 PNG에 비해 불리
- JPEG 표준에도 비손실 압축 방법이 정의되어 있지만, 특허 문제와 압축률 등의 이유로 잘 사용되지 않음
- 여러번 수정 될 때마다 다시 압축되기 때문에 손상됨 (cropped, shifted, param changes..)
- 이미지를 8x8 사이즈의 블락(block)으로 분할한 다음에 각 블락을 이산코사인변환으로 주파수 도메인으로 옮긴다.
  - blocking 현상: 이미지를 8x8 사이즈의 블락으로 분할한 다음 처리하기 때문에 흔적이 남음

## 압축 과정
- Discrete Cosine Transform(DCT)를 기반으로 손실 압축
  - 프레임의 공간 영역을 주파수 영역으로 변환하는 것 (자세한 내용은 생략)
  - 사람은 낮은 주파수 성분에는 민감한 반면 높은 주파수 성분에는 민감하지 않음
  - 높은 주파수 데이터가 생략되더라도 큰 차이를 느끼지 못하는 것을 이용해 압축
- 픽셀당 24비트(빨강, 초록 ,파랑 각 8비트씩)의 색상정보를 가진 데이터를 변환하는 방법

#### 색공간 변환 (Color space transformation)
- 각 픽셀의 RGB 데이터를 YCbCr이라는 색공간 데이터로 변환
  - Y(휘도;  luminance): 어떤 광원의 단위 면적당 광도; 화면이 얼마나 밝은지
  - Cb와 Cr(색차, Chrominance; 크로마): RGB에서 휘도를 뺀 값
    - Cr : R - Y (Red)
    - Cb : B - Y (Blue)
- 사람의 눈이 생상 성분보다 휘도 성분에 더 민감하기 때문에 색상 정보를 더 압축하기 위함
  - 사람의 눈은 밝기 변화를 느끼는 간상세포가 9천만 개 이상이 존재하는데 비하여 색상을 인식하는 원추세포는 약 600만 개정도에 불과함. 
  - 따라서, 사람의 시각은 밝기의 변화에 비하여 색상의 변화에는 둔감하다는 특성이 있음

#### 크로마 서브 샘플링 (Downsampling)
- 휘도에 비해 색차 정보를 줄여서 인코딩하는 방식
- 원래 영상 정보를 R'G'B'(4:4:4)로 표현하는 것과 비교하면 4:2:2 Y'CbCr의 경우 2/3만 용량을 차지함

#### Block splitting
- 각 채널은 8x8로 나뉘어짐; 제한된 정밀도(채널당 8비트) 때문에 정보의 손실이 발생함
- 최소 유닛은 크로마 서브 샘플링에 따라 달라짐
  - 샘플링이 없는 경우: 8x8(4:4:4)
  - 어느정도 된 경우: 16x8(4:2:2), 16x16(4:2:0)

#### Discrete cosine transform
- 각각의 (Y, Cb, Cr)의 각 8x8 블록을 주파수 영역으로 변환함
- 8x8 블록을 64가지 패턴의 선형 조합으로 변환함
- 이미지의 8x8 블록을 아래 패턴의 주파수로 표현함

![image](https://upload.wikimedia.org/wikipedia/commons/thumb/2/23/Dctjpeg.png/440px-Dctjpeg.png)


#### 양자화 (Quantization)
- 사람의 눈은 명도에 대해 비교적 넓은 영역에서 작은 밝기 차이를 구분할 수 있는데, 고주파수 밝기 변화의 정확한 variation을 구분하기 어려움
- 고주파의 명도 변화에서는 그 구별 능력이 떨어져서 고주파 성분의 정보의 많은 부분을 버릴 수 있음
- 주파수 영역의 각 성분에 대해 특정 상수로 나누고 몫만 취함; 가장 손실이 큰 부분

#### 엔트로피 부호화 (Entropy coding)
- 8x8 격자의 성분들을 저주포부터 지그재그로 일렬로 세운뒤, 반복된 0에만 RLE(Run-length encoding) 적용 후 허프만 부호화

## JPEG 2000
- JPEG 보다 높은 압축률과 이미지 품질을 얻기 위해 개발
- 비손실 압축을 지원하고 한 이미지에 여러 해상도의 이미지를 포함
- 호환성 문제 때문에 사용하는 사람이 적음. JPEG과 완전히 새로운 코드로 작성되었고, 좀 더 복잡함

---
## Reference
- https://ko.wikipedia.org/wiki/JPEG, https://en.wikipedia.org/wiki/JPEG
- https://ko.wikipedia.org/wiki/JPEG_2000
- https://bskyvision.com/407
