# Keep Alive; Persistent Connection; Connection reuse

> 이 기능은 비표준이며 표준 트랙이 아닙니다. 
> 웹을 사용하는 프로덕션 사이트에서는 사용하지 마십시오. 
> 모든 사용자에게 적용되는 것은 아닙니다. 
> 구현 간에는 큰 비 호환성이있을 수 있으며 향후 동작이 변경 될 수 있습니다.

- HTTP/1.1 부터지원
- 하나의 TCP 연결을 사용하여 복수의 HTTP 요청/응답을 주고 받음
- 매 요청/응답 마다 새로운 요청을 여는 것과 반대되는 개념
- HTTP/2에선 무시되며, 해당 프로토콜 내에서 다른 메커니즘에 의해 처리됨

`Keep-Alive`: 송신자가 연결에 대한 타임아웃과 요청 최대 갯수를 어떻게 정했는지 알려줌

- `timeout`: 유휴 연결이 계속 열려 있어야 하는 최소한의 시간(초 단위)
- `max`: 연결이 닫히기 이전에 전송될 수 있는 최대 요청수

클라이언트가 요청에 `Connection: close`헤더를 포함해 보냈으면, 그 커넥션으로 추가적인 요청을 보낼 수 없음

프락시에서 클라이언트와 서버 각각에 대해 별도의 keepalive connection을 맺고 관리해야 함

## HTTP는 Stateless 이며 Connection less인데 왜 이 기능이 생겼을까?
- 클라이언트 - 서버 사이에 트랜잭션 한번에 커넥션이 끊어지는 상황
- TCP 커넥션을 맺는 데 발생하는 지연과 느린 시작 지연이 트랜잭션 마다 발생
- 이런 지연을 없애기 위해 한번 연결한 TCP 커넥션을 재활용

## 단점은?
- 서버가 연결을 맺을 수 있는 소켓을 생성하는 데 한계가 있어 연결을 오래 유지하면 다른 사용자 들이 연결을 못함
- 사용자가 많고 유동이 많은 서비스에서는 사용을 권장하진 않음

---
## Reference
- https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Keep-Alive
- https://ko.wikipedia.org/wiki/HTTP_%EC%A7%80%EC%86%8D%EC%A0%81_%EC%97%B0%EA%B2%B0_%EC%83%81%ED%83%9C
